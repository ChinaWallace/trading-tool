# 超级趋势信号使用示例

## 功能说明

已实现完整的多周期SuperTrend信号分析功能，可以根据日线、4小时、1小时、15分钟四个时间周期的SuperTrend指标，生成交易信号和推送通知。

## 核心特点

- ✅ **无需重新计算指标**：直接使用传入数据中已计算好的`supertrend`属性
- ✅ **智能信号识别**：实现策略文档中的10种信号组合判断
- ✅ **分级通知推送**：根据信号强度提供不同级别的通知
- ✅ **批量分析支持**：可同时分析多个交易对

## 数据输入要求

传入的`List<MarketQuotation>`数据必须包含：
- 基础OHLCV数据（开高低收量）
- **已计算的`supertrend`属性**（包含`isUptrend`布尔值）

## 基本使用方法

### 1. 单个交易对信号分析

```java
@Autowired
private SuperTrendSignalService signalService;

// 准备已包含SuperTrend指标的多周期数据
Map<IntervalEnum, List<MarketQuotation>> timeFrameData = new HashMap<>();
timeFrameData.put(IntervalEnum.ONE_DAY, dailyData);        // 日线数据
timeFrameData.put(IntervalEnum.FOUR_HOUR, fourHourData);   // 4小时数据
timeFrameData.put(IntervalEnum.ONE_HOUR, oneHourData);     // 1小时数据
timeFrameData.put(IntervalEnum.FIFTEEN_MINUTE, fifteenMinData); // 15分钟数据

// 分析信号
SuperTrendSignalResult result = signalService.analyzeMultiTimeFrameSignal("BTCUSDT", timeFrameData);

// 查看结果
System.out.println("信号级别: " + result.getSignalLevel().getName());
System.out.println("策略建议: " + result.getSignalCombination().getStrategy());
```

### 2. 分析并推送通知

```java
@Autowired
private SuperTrendNotificationService notificationService;

// 分析并推送（只推送有意义的信号，观望级别不推送）
boolean pushSuccess = notificationService.analyzeAndPushSignal("BTCUSDT", timeFrameData);

if (pushSuccess) {
    System.out.println("信号通知推送成功");
} else {
    System.out.println("信号级别为观望或推送失败");
}
```

### 3. REST API调用

```bash
# 分析单个交易对
POST /api/supertrend/analyze/BTCUSDT
Content-Type: application/json

{
  "dailyData": [...],      // 日线K线数据（已含SuperTrend）
  "fourHourData": [...],   // 4小时K线数据（已含SuperTrend）
  "oneHourData": [...],    // 1小时K线数据（已含SuperTrend）
  "fifteenMinData": [...]  // 15分钟K线数据（已含SuperTrend）
}

# 分析并推送通知
POST /api/supertrend/analyze-and-push/BTCUSDT
```

## 信号判断逻辑

### 10种信号组合

根据4个时间周期的SuperTrend方向组合，系统会自动识别以下信号类型：

| 组合 | 日线 | 4H | 1H | 15min | 信号类型 | 级别 | 策略建议 |
|------|------|----|----|-------|----------|------|----------|
| ① | ↑ | ↑ | ↑ | ↑ | 强势多头共振 | 🔵 强烈 | 坚决做多，分批建仓 |
| ② | ↑ | ↑ | ↑ | ↓ | 回调中多头 | 🟡 中等 | 等待回调结束再做多 |
| ③ | ↑ | ↑ | ↓ | ↑ | 短线反弹 | 🟡 中等 | 快进快出短多单 |
| ④ | ↑ | ↓ | ↑ | ↑ | 背离多头 | 🟡 中等 | 快进快出或控制仓位 |
| ⑤ | ↓ | ↓ | ↓ | ↓ | 强势空头共振 | 🔵 强烈 | 做空为主，顺势操作 |
| ⑥ | ↓ | ↓ | ↓ | ↑ | 短线反弹 | 🟡 中等 | 反弹做空，设好止损 |
| ⑦ | ↓ | ↓ | ↑ | ↑ | 反转尝试 | 🟠 较弱 | 多单试探介入 |
| ⑧ | ↓ | ↑ | ↑ | ↑ | 底部反转 | 🟡 中等 | 尝试底部建仓 |
| ⑨ | ↑ | ↑ | ↓ | ↓ | 回调确认 | ⚪ 观望 | 等待趋势重转 |
| ⑩ | 其他 | - | - | - | 信号混乱 | ⚪ 观望 | 不建议操作 |

### 趋势方向读取

系统从`MarketQuotation.supertrend.isUptrend`属性读取趋势方向：
- `true` = ↑ 上升趋势  
- `false` = ↓ 下降趋势
- `null` = / 趋势不明确

## 通知消息格式

### 强烈信号示例
```
📊 【交易信号 - BTCUSDT】

🕐 周期趋势分析：
├ 日线：↑ 上升
├ 4小时：↑ 上升  
├ 1小时：↑ 上升
└ 15分钟：↑ 上升

🔵 强烈级别

✅ 多周期共振做多信号，建议立即建仓

💡 策略建议：坚决做多，分批建仓

⏰ 分析时间：2025-01-27 10:30:00
```

### 多币种概览示例
```
📊 多币种超级趋势信号概览

🔵 BTCUSDT: ↑↑↑↑ ✅ 多周期共振做多信号，建议立即建仓
🟡 ETHUSDT: ↑↑↑↓ 🔄 15分钟回调中，建议等待短线企稳再介入
🟠 ADAUSDT: ↓↓↑↑ 🔁 潜在底部反转，建议轻仓入场观察

📈 统计：强烈信号 1 个，中等信号 1 个
⏰ 分析时间：2025-01-27 10:30:00
```

## 数据准备示例

```java
// 示例：准备包含SuperTrend的K线数据
List<MarketQuotation> dailyData = new ArrayList<>();
for (KlineData kline : klineList) {
    MarketQuotation quotation = new MarketQuotation();
    // 设置基础数据
    quotation.setOpen(kline.getOpen());
    quotation.setHigh(kline.getHigh());
    quotation.setLow(kline.getLow());
    quotation.setClose(kline.getClose());
    quotation.setVolume(kline.getVolume());
    quotation.setTimestamp(kline.getTimestamp());
    
    // 设置已计算的SuperTrend（关键步骤）
    Supertrend supertrend = new Supertrend(supertrendValue, isUptrend);
    quotation.setSupertrend(supertrend);
    
    dailyData.add(quotation);
}
```

## 注意事项

1. **数据完整性**：确保每个时间周期的数据都包含有效的SuperTrend指标
2. **时间同步**：各周期的最新数据时间应该相对同步
3. **推送控制**：系统只推送强烈、中等、较弱级别的信号，观望级别不推送
4. **异常处理**：如果SuperTrend数据缺失，系统会记录警告并返回"不明确"趋势
5. **性能优化**：无需重复计算指标，直接使用已有结果，提高分析效率

## 扩展使用

### 自定义推送渠道

继承`SuperTrendNotificationService`并重写推送方法：

```java
@Service
public class CustomNotificationService extends SuperTrendNotificationService {
    
    @Override
    protected boolean pushNotificationCallback(String content) {
        // 实现自定义推送逻辑（如钉钉、企业微信、Telegram等）
        return yourCustomPushMethod(content);
    }
}
```

### 批量监控

```java
// 监控多个交易对
Map<String, Map<IntervalEnum, List<MarketQuotation>>> symbolDataMap = new HashMap<>();
symbolDataMap.put("BTCUSDT", btcTimeFrameData);
symbolDataMap.put("ETHUSDT", ethTimeFrameData);
symbolDataMap.put("ADAUSDT", adaTimeFrameData);

// 批量分析并推送概览
notificationService.analyzeMultipleSymbolsAndPush(symbolDataMap);
```

这样就可以高效地使用已计算的SuperTrend数据进行多周期信号分析和通知推送了！ 